<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .bg { fill: #2f2f2f; }
      .arrow-fill { fill: #AAA; }
      .stroke-primary { stroke: #AAA; stroke-width: 2; fill: none; }
      .stroke-dashed { stroke: #AAA; stroke-width: 1.5; stroke-dasharray: 5,5; fill: none; }
      .line-primary { stroke: #AAA; stroke-width: 2; }
      .text-title { font-family: Arial, sans-serif; font-size: 20px; font-weight: bold; fill: white; text-anchor: middle; }
      .text-section { font-family: Arial, sans-serif; font-size: 18px; font-weight: bold; fill: white; text-anchor: middle; }
      .text-box-title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; fill: white; text-anchor: middle; }
      .text-code { font-family: Arial, sans-serif; font-size: 12px; fill: white; text-anchor: middle; }
      .rect-layer { fill: #3D3D3D; }
      .rect-sublayer { fill: #4D4D4D; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7"
     refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" class="arrow-fill" />
    </marker>
  </defs>

  <rect width="800" height="600" class="bg"/>
  
  <!-- Application Layer -->
  <rect x="50" y="70" width="700" height="80" rx="5" class="stroke-primary rect-layer"/>
  <text x="400" y="115" class="text-title">Application Code</text>
  
  <!-- Model Layer -->
  <rect x="50" y="200" width="700" height="300" rx="5" class="stroke-primary rect-layer"/>
  <text x="400" y="225" class="text-title">Model Layer</text>
  
  <!-- BMC Layer -->
  <rect x="70" y="240" width="660" height="80" rx="5" class="stroke-primary rect-sublayer"/>
  <text x="400" y="275" class="text-section">Backend Model Controllers (BMCs)</text>
  <text x="180" y="295" class="text-box-title">UserBmc</text>
  <text x="320" y="295" class="text-box-title">AgentBmc</text>
  <text x="460" y="295" class="text-box-title">ConvBmc</text>
  <text x="600" y="295" class="text-box-title">ConvMsgBmc</text>
  
  <!-- Base Layer -->
  <rect x="70" y="340" width="660" height="70" rx="5" class="stroke-primary rect-sublayer"/>
  <text x="400" y="380" class="text-section">Base CRUD Functions</text>
  
  <!-- ModelManager Layer -->
  <rect x="70" y="430" width="660" height="60" rx="5" class="stroke-primary rect-sublayer"/>
  <text x="400" y="465" class="text-section">ModelManager (Resource Manager)</text>
  
  <!-- Database Layer -->
  <rect x="50" y="550" width="700" height="50" rx="5" class="stroke-primary rect-layer"/>
  <text x="400" y="580" class="text-title">Database (PostgreSQL)</text>
  
  <!-- Flow Arrows -->
  <!-- App to BMC -->
  <line x1="400" y1="150" x2="400" y2="240" class="line-primary" marker-end="url(#arrowhead)"/>
  <text x="440" y="185" class="text-code">Context + Request</text>
  
  <!-- BMC to Base -->
  <line x1="400" y1="320" x2="400" y2="340" class="line-primary" marker-end="url(#arrowhead)"/>
  
  <!-- Base to ModelManager -->
  <line x1="400" y1="410" x2="400" y2="430" class="line-primary" marker-end="url(#arrowhead)"/>
  
  <!-- ModelManager to DB -->
  <line x1="400" y1="490" x2="400" y2="550" class="line-primary" marker-end="url(#arrowhead)"/>
  <text x="440" y="525" class="text-code">SQL Queries</text>
  
  <!-- Response Flow -->
  <line x1="320" y1="550" x2="320" y2="150" class="stroke-dashed" marker-end="url(#arrowhead)"/>
  <text x="300" y="350" class="text-code">Response</text>
  
  <!-- Context Flow -->
  <path d="M100,150 C50,220 50,420 100,550" class="stroke-dashed"/>
  <text x="75" y="350" class="text-code" transform="rotate(-90, 75, 350)">Context (Ctx)</text>

</svg>
